/*!
 * Tabledit v1.2.5 (https://github.com/ars-anosov/jquery-tabledit)
 * Copyright (c) 2015 Celso Marques
 * Licensed under MIT (https://github.com/ars-anosov/jquery-tabledit/blob/master/LICENSE)
 */
if("undefined"==typeof jQuery)throw new Error("Tabledit requires jQuery library.");!function(c){"use strict";c.fn.Tabledit=function(t){if(!this.is("table"))throw new Error("Tabledit only works when applied to a table.");var d=this,e={url:window.location.href,inputClass:"form-control input-sm",toolbarClass:"btn-toolbar",groupClass:"btn-group btn-group-sm",dangerClass:"danger",warningClass:"warning",mutedClass:"text-muted",eventType:"click",rowIdentifier:"id",hideIdentifier:!1,autoFocus:!0,editButton:!0,deleteButton:!0,saveButton:!0,restoreButton:!0,buttons:{edit:{class:"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-pencil"></span>',action:"edit"},delete:{class:"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-trash"></span>',action:"delete"},save:{class:"btn btn-sm btn-success",html:"Save"},restore:{class:"btn btn-sm btn-warning",html:"Restore",action:"restore"},confirm:{class:"btn btn-sm btn-danger",html:"Confirm"}},onDraw:function(){},onSuccess:function(){},onFail:function(){},onAlways:function(){},onAjax:function(){}},s=c.extend(!0,e,t),a="undefined",l="undefined",t={identifier:function(){s.hideIdentifier&&d.find("th:nth-child("+(parseInt(s.columns.identifier[0])+1)+"), tbody td:nth-child("+(parseInt(s.columns.identifier[0])+1)+")").hide(),d.find("tbody td:nth-child("+(parseInt(s.columns.identifier[0])+1)+")").each(function(){var t='<span class="tabledit-span tabledit-identifier">'+c(this).text()+"</span>",e='<input class="tabledit-input tabledit-identifier" type="hidden" name="'+s.columns.identifier[1]+'" value="'+c(this).text()+'" disabled>';c(this).html(t+e),c(this).parent("tr").attr(s.rowIdentifier,c(this).text())})},editable:function(){for(var e=0;e<s.columns.editable.length;e++)d.find("tbody td:nth-child("+(parseInt(s.columns.editable[e][0])+1)+")").each(function(){var n=(n=c(this).text()).replace(/\[(.*)\]/,'<a href="$1">$1</a>');s.editButton||c(this).css("cursor","pointer");var t='<span class="tabledit-span">'+n+"</span>";s.columns.editable[e][2]&&"textarea"==s.columns.editable[e][2]&&(t='<pre class="tabledit-span">'+n+"</pre>");var i="";switch(s.columns.editable[e][2]){case"textarea":i='<textarea class="tabledit-input '+s.inputClass+'" name="'+s.columns.editable[e][1]+'" style="display: none;" disabled>'+c(this).text()+"</textarea>";break;case"select":i='<select class="tabledit-input '+s.inputClass+'" name="'+s.columns.editable[e][1]+'" style="display: none;" disabled>',c.each(jQuery.parseJSON(s.columns.editable[e][3]),function(t,e){i+=n===e?'<option value="'+t+'" selected>'+e+"</option>":'<option value="'+t+'">'+e+"</option>"}),i+="</select>";break;default:i='<input class="tabledit-input '+s.inputClass+'" type="text" name="'+s.columns.editable[e][1]+'" value="'+c(this).text()+'" style="display: none;" disabled>'}c(this).html(t+i),c(this).addClass("tabledit-view-mode")})},toolbar:function(){var t,e,n,i,a;(s.editButton||s.deleteButton)&&(i=a=n=e=t="",0===d.find("th.tabledit-toolbar-column").length&&d.find("tr:first").append('<th class="tabledit-toolbar-column"></th>'),s.editButton&&(t='<button type="button" class="tabledit-edit-button '+s.buttons.edit.class+'" style="float: none;">'+s.buttons.edit.html+"</button>"),s.deleteButton&&(e='<button type="button" class="tabledit-delete-button '+s.buttons.delete.class+'" style="float: none;">'+s.buttons.delete.html+"</button>",i='<button type="button" class="tabledit-confirm-button '+s.buttons.confirm.class+'" style="display: none; float: none;">'+s.buttons.confirm.html+"</button>"),s.editButton&&s.saveButton&&(n='<button type="button" class="tabledit-save-button '+s.buttons.save.class+'" style="display: none; float: none;">'+s.buttons.save.html+"</button>"),s.deleteButton&&s.restoreButton&&(a='<button type="button" class="tabledit-restore-button '+s.buttons.restore.class+'" style="display: none; float: none;">'+s.buttons.restore.html+"</button>"),a='<div class="tabledit-toolbar '+s.toolbarClass+'" style="text-align: left;">\n                                             <div class="'+s.groupClass+'" style="float: none;">'+t+e+"</div>\n                                             "+n+"\n                                             "+i+"\n                                             "+a+"\n                                         </div></div>",d.find("tbody>tr").append('<td style="white-space: nowrap; width: 1%;">'+a+"</td>"))}},n=function(t){var e=c(t).parent("tr");c(t).parent("tr").find(".tabledit-input.tabledit-identifier").prop("disabled",!0),c(t).find(".tabledit-input").blur().hide().prop("disabled",!0),c(t).find(".tabledit-span").show(),c(t).addClass("tabledit-view-mode").removeClass("tabledit-edit-mode"),s.editButton&&(e.find("button.tabledit-save-button").hide(),e.find("button.tabledit-edit-button").removeClass("active").blur())},o=function(t){b.reset(t);var e=c(t).parent("tr");e.find(".tabledit-input.tabledit-identifier").prop("disabled",!1),c(t).find(".tabledit-span").hide();var n=c(t).find(".tabledit-input");n.prop("disabled",!1).show(),s.autoFocus&&n.focus(),c(t).addClass("tabledit-edit-mode").removeClass("tabledit-view-mode"),s.editButton&&(e.find("button.tabledit-edit-button").addClass("active"),e.find("button.tabledit-save-button").show())},r=function(t){c(t).each(function(){var t=c(this).find(".tabledit-input"),e=c(this).find(".tabledit-span").text();t.is("select")?t.find("option").filter(function(){return c.trim(c(this).text())===e}).attr("selected",!0):t.val(e),n(this)})},u=function(t){!1!==i(s.buttons.edit.action)&&(c(t).each(function(){var t=c(this).find(".tabledit-input");t.is("select")?c(this).find(".tabledit-span").text(t.find("option:selected").text()):c(this).find(".tabledit-span").text(t.val()),n(this)}),a=c(t).parent("tr"))},b={reset:function(t){d.find(".tabledit-confirm-button").hide(),d.find(".tabledit-delete-button").removeClass("active").blur()},submit:function(t){b.reset(t),c(t).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var e=i(s.buttons.delete.action);c(t).parents("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==e&&(c(t).parent("tr").addClass("tabledit-deleted-row"),c(t).parent("tr").addClass(s.mutedClass).find(".tabledit-toolbar button:not(.tabledit-restore-button)").attr("disabled",!0),c(t).find(".tabledit-restore-button").show(),l=c(t).parent("tr"))},confirm:function(t){d.find("td.tabledit-edit-mode").each(function(){r(this)}),c(t).find(".tabledit-delete-button").addClass("active"),c(t).find(".tabledit-confirm-button").show()},restore:function(t){c(t).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var e=i(s.buttons.restore.action);c(t).parents("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==e&&(c(t).parent("tr").removeClass("tabledit-deleted-row"),c(t).parent("tr").removeClass(s.mutedClass).find(".tabledit-toolbar button").attr("disabled",!1),c(t).find(".tabledit-restore-button").hide(),c(t).parent("tr"))}};function i(i){var t=d.find(".tabledit-input").serialize();if(!t)return!1;if(t+="&action="+i,!1===s.onAjax(i,t))return!1;t=c.post(s.url,t,function(t,e,n){i===s.buttons.edit.action&&(a.removeClass(s.dangerClass).addClass(s.warningClass),setTimeout(function(){d.find("tr."+s.warningClass).removeClass(s.warningClass)},1400)),s.onSuccess(t,e,n)},"json");return t.fail(function(t,e,n){i===s.buttons.delete.action?(l.removeClass(s.mutedClass).addClass(s.dangerClass),l.find(".tabledit-toolbar button").attr("disabled",!1),l.find(".tabledit-toolbar .tabledit-restore-button").hide()):i===s.buttons.edit.action&&a.addClass(s.dangerClass),s.onFail(t,e,n)}),t.always(function(){s.onAlways()}),t}return t.identifier(),t.editable(),t.toolbar(),s.onDraw(),s.deleteButton&&(d.on("click","button.tabledit-delete-button",function(t){var e,n;!0!==t.handled&&(t.preventDefault(),e=c(this).hasClass("active"),n=c(this).parents("td"),b.reset(n),e||b.confirm(n),t.handled=!0)}),d.on("click","button.tabledit-confirm-button",function(t){var e;!0!==t.handled&&(t.preventDefault(),e=c(this).parents("td"),b.submit(e),t.handled=!0)})),s.restoreButton&&d.on("click","button.tabledit-restore-button",function(t){!0!==t.handled&&(t.preventDefault(),b.restore(c(this).parents("td")),t.handled=!0)}),s.editButton?(d.on("click","button.tabledit-edit-button",function(t){var e,n;!0!==t.handled&&(t.preventDefault(),n=(e=c(this)).hasClass("active"),r(d.find("td.tabledit-edit-mode")),n||c(e.parents("tr").find("td.tabledit-view-mode").get().reverse()).each(function(){o(this)}),t.handled=!0)}),d.on("click","button.tabledit-save-button",function(t){!0!==t.handled&&(t.preventDefault(),u(c(this).parents("tr").find("td.tabledit-edit-mode")),t.handled=!0)})):(d.on(s.eventType,"tr:not(.tabledit-deleted-row) td.tabledit-view-mode",function(t){!0!==t.handled&&(t.preventDefault(),r(d.find("td.tabledit-edit-mode")),o(this),t.handled=!0)}),d.on("change","select.tabledit-input:visible",function(t){!0!==t.handled&&(u(c(this).parent("td")),t.handled=!0)}),c(document).on("click",function(t){var e=d.find(".tabledit-edit-mode");e.is(t.target)||0!==e.has(t.target).length||r(d.find(".tabledit-input:visible").parent("td"))})),d.on("keyup",function(t){var e=d.find(".tabledit-input:visible"),n=d.find(".tabledit-confirm-button");if(0<e.length)var i=e.parents("td");else{if(!(0<n.length))return;i=n.parents("td")}switch(t.keyCode){case 9:s.editButton||(u(i),o(i.closest("td").next()));break;case 13:(t.ctrlKey&&"TEXTAREA"==t.target.tagName||"TEXTAREA"!=t.target.tagName)&&u(i);break;case 27:r(i),b.reset(i)}}),this}}(jQuery);