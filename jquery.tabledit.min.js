/*!
 * Tabledit v1.3.0 (https://github.com/ars-anosov/jquery-tabledit)
 * Copyright (c) 2015 Celso Marques
 * Licensed under MIT (https://github.com/ars-anosov/jquery-tabledit/blob/master/LICENSE)
 */
if("undefined"==typeof jQuery)throw new Error("Tabledit requires jQuery library.");!function(c){"use strict";c.fn.Tabledit=function(t){if(!this.is("table"))throw new Error("Tabledit only works when applied to a table.");var s=this,e={url:window.location.href,inputClass:"form-control form-control-sm",toolbarClass:"btn-toolbar",groupClass:"btn-group btn-group-sm",dangerClass:"table-danger",warningClass:"table-success",mutedClass:"table-warning",eventType:"click",rowIdentifier:"id",hideIdentifier:!1,autoFocus:!0,editButton:!0,deleteButton:!0,saveButton:!0,restoreButton:!0,buttons:{edit:{class:"btn btn-outline-secondary",html:'<span class="bi bi-pencil"></span>',action:"edit"},delete:{class:"btn btn-outline-secondary",html:'<span class="bi bi-trash"></span>',action:"delete"},save:{class:"btn btn-sm btn-success",html:"Save"},restore:{class:"btn btn-sm btn-warning",html:"Restore",action:"restore"},confirm:{class:"btn btn-sm btn-danger",html:"Confirm"}},onDraw:function(){},onSuccess:function(){},onFail:function(){},onAlways:function(){},onAjax:function(){}},d=c.extend(!0,e,t),a="undefined",l="undefined",t={identifier:function(){d.hideIdentifier&&s.find("th:nth-child("+(parseInt(d.columns.identifier[0])+1)+"), tbody td:nth-child("+(parseInt(d.columns.identifier[0])+1)+")").hide(),s.find("tbody td:nth-child("+(parseInt(d.columns.identifier[0])+1)+")").each(function(){var t='<span class="tabledit-span tabledit-identifier">'+c(this).text()+"</span>",e='<input class="tabledit-input tabledit-identifier" type="hidden" name="'+d.columns.identifier[1]+'" value="'+c(this).text()+'" disabled>';c(this).html(t+e),c(this).parent("tr").attr(d.rowIdentifier,c(this).text())})},editable:function(){for(var e=0;e<d.columns.editable.length;e++)s.find("tbody td:nth-child("+(parseInt(d.columns.editable[e][0])+1)+")").each(function(){var n=(n=c(this).text()).replace(new RegExp(/\[(.*)\]/,"g"),'<a href="$1">$1</a>');d.editButton||c(this).css("cursor","pointer");var t='<span class="tabledit-span">'+n+"</span>";d.columns.editable[e][2]&&"textarea"==d.columns.editable[e][2]&&(t='<span class="tabledit-span" style="font-family: monospace; white-space: pre-wrap;">'+n+"</span>");var i="";switch(d.columns.editable[e][2]){case"textarea":i='<textarea rows="'+c(this).text().split("\n").length+'" class="tabledit-input '+d.inputClass+'" name="'+d.columns.editable[e][1]+'" style="display: none; font-family: monospace;" disabled>'+c(this).text()+"</textarea>";break;case"select":i='<select class="tabledit-input '+d.inputClass+'" name="'+d.columns.editable[e][1]+'" style="display: none;" disabled>',c.each(jQuery.parseJSON(d.columns.editable[e][3]),function(t,e){i+=n===e?'<option value="'+t+'" selected>'+e+"</option>":'<option value="'+t+'">'+e+"</option>"}),i+="</select>";break;default:i='<input class="tabledit-input '+d.inputClass+'" type="text" name="'+d.columns.editable[e][1]+'" value="'+c(this).text()+'" style="display: none;" disabled>'}c(this).html(t+i),c(this).addClass("tabledit-view-mode")})},toolbar:function(){var t,e,n,i,a;(d.editButton||d.deleteButton)&&(i=a=n=e=t="",0===s.find("th.tabledit-toolbar-column").length&&s.find("tr:first").append('<th class="tabledit-toolbar-column"></th>'),d.editButton&&(t='<button type="button" class="tabledit-edit-button '+d.buttons.edit.class+'" style="float: none;">'+d.buttons.edit.html+"</button>"),d.deleteButton&&(e='<button type="button" class="tabledit-delete-button '+d.buttons.delete.class+'" style="float: none;">'+d.buttons.delete.html+"</button>",i='<button type="button" class="tabledit-confirm-button '+d.buttons.confirm.class+'" style="display: none; float: none;">'+d.buttons.confirm.html+"</button>"),d.editButton&&d.saveButton&&(n='<button type="button" class="tabledit-save-button '+d.buttons.save.class+'" style="display: none; float: none;">'+d.buttons.save.html+"</button>"),d.deleteButton&&d.restoreButton&&(a='<button type="button" class="tabledit-restore-button '+d.buttons.restore.class+'" style="display: none; float: none;">'+d.buttons.restore.html+"</button>"),a='<div class="tabledit-toolbar '+d.toolbarClass+'" role="toolbar" style="text-align: left; display: block;">\n                                             <div class="'+d.groupClass+'" role="group" style="float: none;">'+t+e+"</div>\n                                             "+n+"\n                                             "+i+"\n                                             "+a+"\n                                         </div></div>",s.find("tbody>tr").append('<td style="white-space: nowrap; width: 1%;">'+a+"</td>"))}},n=function(t){var e=c(t).parent("tr");c(t).parent("tr").find(".tabledit-input.tabledit-identifier").prop("disabled",!0),c(t).find(".tabledit-input").blur().hide().prop("disabled",!0),c(t).find(".tabledit-span").show(),c(t).addClass("tabledit-view-mode").removeClass("tabledit-edit-mode"),d.editButton&&(e.find("button.tabledit-save-button").hide(),e.find("button.tabledit-edit-button").removeClass("active").blur())},o=function(t){u.reset(t);var e=c(t).parent("tr");e.find(".tabledit-input.tabledit-identifier").prop("disabled",!1),c(t).find(".tabledit-span").hide();var n=c(t).find(".tabledit-input");n.prop("disabled",!1).show(),d.autoFocus&&n.focus(),c(t).addClass("tabledit-edit-mode").removeClass("tabledit-view-mode"),d.editButton&&(e.find("button.tabledit-edit-button").addClass("active"),e.find("button.tabledit-save-button").show())},r=function(t){c(t).each(function(){var t=c(this).find(".tabledit-input"),e=c(this).find(".tabledit-span").text();t.is("select")?t.find("option").filter(function(){return c.trim(c(this).text())===e}).attr("selected",!0):t.val(e),n(this)})},b=function(t){!1!==i(d.buttons.edit.action)&&(c(t).each(function(){var t=c(this).find(".tabledit-input");t.is("select")?c(this).find(".tabledit-span").text(t.find("option:selected").text()):c(this).find(".tabledit-span").text(t.val()),n(this)}),a=c(t).parent("tr"))},u={reset:function(t){s.find(".tabledit-confirm-button").hide(),s.find(".tabledit-delete-button").removeClass("active").blur()},submit:function(t){u.reset(t),c(t).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var e=i(d.buttons.delete.action);c(t).parents("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==e&&(c(t).parent("tr").addClass("tabledit-deleted-row"),c(t).parent("tr").addClass(d.mutedClass).find(".tabledit-toolbar button:not(.tabledit-restore-button)").attr("disabled",!0),c(t).find(".tabledit-restore-button").show(),l=c(t).parent("tr"))},confirm:function(t){s.find("td.tabledit-edit-mode").each(function(){r(this)}),c(t).find(".tabledit-delete-button").addClass("active"),c(t).find(".tabledit-confirm-button").show()},restore:function(t){c(t).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var e=i(d.buttons.restore.action);c(t).parents("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==e&&(c(t).parent("tr").removeClass("tabledit-deleted-row"),c(t).parent("tr").removeClass(d.mutedClass).find(".tabledit-toolbar button").attr("disabled",!1),c(t).find(".tabledit-restore-button").hide(),c(t).parent("tr"))}};function i(i){var t=s.find(".tabledit-input").serialize();if(!t)return!1;if(t+="&action="+i,!1===d.onAjax(i,t))return!1;t=c.post(d.url,t,function(t,e,n){i===d.buttons.edit.action&&(a.removeClass(d.dangerClass).addClass(d.warningClass),setTimeout(function(){s.find("tr."+d.warningClass).removeClass(d.warningClass)},1400)),d.onSuccess(t,e,n)},"json");return t.fail(function(t,e,n){i===d.buttons.delete.action?(l.removeClass(d.mutedClass).addClass(d.dangerClass),l.find(".tabledit-toolbar button").attr("disabled",!1),l.find(".tabledit-toolbar .tabledit-restore-button").hide()):i===d.buttons.edit.action&&a.addClass(d.dangerClass),d.onFail(t,e,n)}),t.always(function(){d.onAlways()}),t}return t.identifier(),t.editable(),t.toolbar(),d.onDraw(),d.deleteButton&&(s.on("click","button.tabledit-delete-button",function(t){var e,n;!0!==t.handled&&(t.preventDefault(),e=c(this).hasClass("active"),n=c(this).parents("td"),u.reset(n),e||u.confirm(n),t.handled=!0)}),s.on("click","button.tabledit-confirm-button",function(t){var e;!0!==t.handled&&(t.preventDefault(),e=c(this).parents("td"),u.submit(e),t.handled=!0)})),d.restoreButton&&s.on("click","button.tabledit-restore-button",function(t){!0!==t.handled&&(t.preventDefault(),u.restore(c(this).parents("td")),t.handled=!0)}),d.editButton?(s.on("click","button.tabledit-edit-button",function(t){var e,n;!0!==t.handled&&(t.preventDefault(),n=(e=c(this)).hasClass("active"),r(s.find("td.tabledit-edit-mode")),n||c(e.parents("tr").find("td.tabledit-view-mode").get().reverse()).each(function(){o(this)}),t.handled=!0)}),s.on("click","button.tabledit-save-button",function(t){!0!==t.handled&&(t.preventDefault(),b(c(this).parents("tr").find("td.tabledit-edit-mode")),t.handled=!0)})):(s.on(d.eventType,"tr:not(.tabledit-deleted-row) td.tabledit-view-mode",function(t){!0!==t.handled&&(t.preventDefault(),r(s.find("td.tabledit-edit-mode")),o(this),t.handled=!0)}),s.on("change","select.tabledit-input:visible",function(t){!0!==t.handled&&(b(c(this).parent("td")),t.handled=!0)}),c(document).on("click",function(t){var e=s.find(".tabledit-edit-mode");e.is(t.target)||0!==e.has(t.target).length||r(s.find(".tabledit-input:visible").parent("td"))})),s.on("keyup",function(t){var e=s.find(".tabledit-input:visible"),n=s.find(".tabledit-confirm-button");if(0<e.length)var i=e.parents("td");else{if(!(0<n.length))return;i=n.parents("td")}switch(t.keyCode){case 9:d.editButton||(b(i),o(i.closest("td").next()));break;case 13:(t.ctrlKey&&"TEXTAREA"==t.target.tagName||"TEXTAREA"!=t.target.tagName)&&b(i);break;case 27:r(i),u.reset(i)}}),this}}(jQuery);